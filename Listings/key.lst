C51 COMPILER V9.60.0.0   KEY                                                               03/20/2023 10:31:11 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\others) DEBUG OBJECTEXTEND PRINT
                    -(.\Listings\key.lst) TABS(2) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "key.h"
   2          
   3          /* обцФапЁЖ╣дкЫсп╟╢╪Э╨╞йЩ
   4             ╬Ый╧сцуБа╫╦Ж╠Да©вВн╙йДЁЖё╛
   5             жВ╨╞йЩюОж╩пХр╙еп╤оуБа╫╦Ж╠Да©ё╛
   6             ╪╢©и╩Ях║╟╢╪Эв╢л╛пео╒ */
   7          uint8_t key_value = 0; //х║ж╣╥╤н╖4 - 19
   8          uint8_t key_state = 0;
   9          /* key_state╠Мй╬╟╢╪Э╣╠г╟в╢л╛
  10             0ё╨╠Мй╬н╢╟╢об
  11             1ё╨╟╢╪ЭуЩтзоШ╤╤╢╕юМ
  12             2 - 250ё╨╠Мй╬оШ╤╤рт╨С╟╢об╣дй╠╪Дё╛╣╔н╩йг10ms
  13                      ╠╬дё╟Еж╩╪фй╠╣╫2.5цКё╛пХр╙╣д©иртясЁ╓
  14                      в╒рБр╙╦дЁиuint16_tюЮпм
  15             255ё╨╣╠г╟╟╢╪Эки©╙
  16                  г╟цФ╣дй╠╪ДясЁ╓ак╢к╢╕р╡р╙пч╦д╣╫╨ойй╣дж╣ */
  17          
  18          /* обап╨╞йЩр╩╟Ц╤╪йг10msвСср╣Всцр╩╢нё╛
  19             10msн╙оШ╤╤й╠╪Дё╛©ирт╦Ы╬щпХр╙╦Э╦д */
  20          
  21          /* ╪Эж╣╡Ия╞╠М */
  22          uint8_t code key_pad_value_all[4][4] = 
  23          { //Ёёсцсз╬ьуС╟╢╪Э
  24            {19, 15, 11, 7, }, 
  25            {18, 14, 10, 6, }, 
  26            {17, 13, 9, 5, }, 
  27            {16, 12, 8, 4, }, 
  28          };
  29          uint8_t code key_pad_value_half[2][4] = 
  30          { //ж╩спр╩╟К╣д╟╢╪Эё╛Ёёсцсз╨м╢╝©зм╛й╠й╧сц╣д╬ьуС╟╢╪Э
  31            {17, 13, 9, 5, }, 
  32            {16, 12, 8, 4, }, 
  33          };
  34          uint8_t code key_pad_value_remain[2][3] = 
  35          { //╡пх╠╣д╬ьуС╪Эелё╛Ёёсцсз╢╝©з╨мхЩнЕ╤╗й╠фВф╣бй╡Ба©м╛й╠й╧сцй╠╣д╬ьуС╟╢╪Э
  36            {13, 9, 5, }, 
  37            {12, 8, 4, }, 
  38          };
  39          
  40          /* пбйж╪Р╣╔╟Ф ╤юа╒╟╢╪Э */
  41          void key_scan_simple()
  42          {
  43   1        /* ╡ывВIO©з */
  44   1        P3 |= 0x0F; //P30 - P33╬ЫйДЁЖ╦ъ╣Гф╫
  45   1        
  46   1        if (~P3 & 0x0F)
  47   1        /* хГ╧Шсп╟╢╪Э╟╢обё╩уБюО©ирт╥╜рКн╙
  48   1           P3х║╥╢╨Сфа╠н╣Т╦ъкдн╩ё╛вэж╝хТсп╟╢╪Э╟╢обё╛
  49   1           тРуБ╦Ж╫А╧Ш╬м╡╩н╙аЦ */
  50   1        {
  51   2          /* ╪Эж╣еп╤о */
  52   2          if (!P33) //P33хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS4╟╢об
  53   2            key_value = 4;
  54   2          else if (!P32) //P32хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS5╟╢об
C51 COMPILER V9.60.0.0   KEY                                                               03/20/2023 10:31:11 PAGE 2   

  55   2            key_value = 5;
  56   2          else if (!P31) //P31хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS6╟╢об
  57   2            key_value = 6;
  58   2          else if (!P30) //P30хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS7╟╢об
  59   2            key_value = 7;
  60   2          
  61   2          /* ╟╢╪Э╪фй╠ */
  62   2          if (key_state < 250)
  63   2            key_state++;
  64   2        }
  65   1        else //хГ╧Шц╩сп╟╢╪Э╟╢об
  66   1        {
  67   2          /* гЕаЦ */
  68   2          key_value = 0;
  69   2          key_state = 0;
  70   2        }
  71   1      }
  72          
  73          /* пбйж╪Р╣╔╟Ф ╬ьуС╟╢╪Э */
  74          void key_pad_scan_simple()
  75          {
  76   1        uint8_t row = 255, column = 255; //пп╨есКап╨её╛255йгд╛хож╣ё╛нчп╖ж╣
  77   1        
  78   1        /* ╡ывВIO©з */
  79   1        P3 = 0x0F; // P30 - P33╬ЫйДЁЖ╦ъ╣Гф╫ё╛P34 - P37╬ЫйДЁЖ╣м╣Гф╫ё╛й╣╪йиоP36╨мP37йг╡╩сц╧э╣дё╛ж╩йгп╢фПю╢╥╫╠Ц
  80   1        P4 = 0x00; // P4йДЁЖ╣м╣Гф╫ё╛й╣╪йиож╩пХр╙P42╨мP44йДЁЖ╣м╣Гф╫╪╢©и
  81   1        
  82   1        if (~P3 & 0x0F) //хГ╧Шсп╟╢╪Э╟╢обё╩уБюО©ирт╥╜рКн╙P3х║╥╢╨Сфа╠н╣Т╦ъкдн╩ё╛сп╟╢╪Э╟╢обтРуБ╦Ж╫А╧Ш╬м╡╩н╙аЦё╛╨мг╟ц
             -Ф╤юа╒╟╢╪Эр╩жб╣д
  83   1        {
  84   2          /* ппеп╤о */
  85   2          if (!P30) //╣з1пп
  86   2            row = 0;
  87   2          else if (!P31) //╣з2пп
  88   2            row = 1;
  89   2          else if (!P32) //╣з3пп
  90   2            row = 2;
  91   2          else if (!P33) //╣з4пп
  92   2            row = 3;
  93   2          
  94   2          /* ╡ывВIO©з */
  95   2          P3 = 0xF0; // P30 - P33╬ЫйДЁЖ╣м╣Гф╫ё╛P34 - P37╬ЫйДЁЖ╦ъ╣Гф╫ё╛й╣╪йиоP36╨мP37йг╡╩сц╧э╣дё╛ж╩йгп╢фПю╢╥╫╠Ц
  96   2          P4 = 0xFF; // P4йДЁЖ╦ъ╣Гф╫ё╛й╣╪йиож╩пХр╙P42╨мP44йДЁЖ╦ъ╣Гф╫╪╢©и
  97   2        
  98   2          /* апеп╤о */
  99   2          if (!P34) //╣з1ап
 100   2            column = 0;
 101   2          else if (!P35) //╣з2ап
 102   2            column = 1;
 103   2          else if (!P42) //╣з3ап
 104   2            column = 2;
 105   2          else if (!P44) //╣з4ап
 106   2            column = 3;
 107   2          
 108   2          /* ╪Эж╣еп╤о */
 109   2          if (row != 255 && column != 255) //хГ╧Ш╟╢╪Эспп╖
 110   2          {
 111   3            key_value = key_pad_value_all[row][column];
 112   3          }
 113   2          
 114   2          /* ╟╢╪Э╪фй╠ */
 115   2          if (key_state < 250)
C51 COMPILER V9.60.0.0   KEY                                                               03/20/2023 10:31:11 PAGE 3   

 116   2            key_state++;
 117   2        }
 118   1        else
 119   1        {
 120   2          key_value = 0;
 121   2          key_state = 0;
 122   2        }
 123   1      }
 124          
 125          /* кийж╪Л╡Б╟Ф ╤юа╒╟╢╪Э */
 126          void key_scan_release()
 127          {
 128   1        /* ╡ывВIO©з */
 129   1        P3 |= 0x0F; //P30 - P33╬ЫйДЁЖ╦ъ╣Гф╫
 130   1        
 131   1        if (~P3 & 0x0F)
 132   1        /* хГ╧Шсп╟╢╪Э╟╢обё╩уБюО©ирт╥╜рКн╙
 133   1           P3х║╥╢╨Сфа╠н╣Т╦ъкдн╩ё╛вэж╝хТсп╟╢╪Э╟╢обё╛
 134   1           тРуБ╦Ж╫А╧Ш╬м╡╩н╙аЦ */
 135   1        {
 136   2          /* ╪Эж╣еп╤о */
 137   2          if (!P33) //P33хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS4╟╢об
 138   2            key_value = 4;
 139   2          else if (!P32) //P32хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS5╟╢об
 140   2            key_value = 5;
 141   2          else if (!P31) //P31хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS6╟╢об
 142   2            key_value = 6;
 143   2          else if (!P30) //P30хГ╧Ш╠╩ю╜╣мтР╟╢╪ЭS7╟╢об
 144   2            key_value = 7;
 145   2          
 146   2          /* ╟╢╪Э╪фй╠ */
 147   2          if (key_state < 250)
 148   2            key_state++;
 149   2        }
 150   1        else //хГ╧Шц╩сп╟╢╪Э╟╢об
 151   1        {
 152   2          /* ╨мц╩╢Ькийж╪Л╡Б╣д╟Ф╠╬ж╩спобцФ╣дгЬ╠П */
 153   2          if (key_value && (key_state <= 250)) //хГ╧Ш╟╢╪Э╦уки©╙
 154   2          {
 155   3            if (key_state < 100) //хТ╟╢об╣╫кийжй╠╪Дц╩спЁ╛╧Щ1цК
 156   3              key_state = 255;
 157   3            else if (key_state < 200) //хТ╟╢об╣╫кийжй╠╪ДЁ╛╧Щ1цК╤Ьц╩Ё╛╧Щ2цК
 158   3              key_state = 254;
 159   3            else //хТ╟╢об╣╫кийжй╠╪ДЁ╛╧Щ2цК
 160   3              key_state = 253;
 161   3          }
 162   2          else //╟╢╪ЭмЙх╚ки©╙
 163   2          {
 164   3            key_value = 0;
 165   3            key_state = 0;
 166   3          }
 167   2        }
 168   1      }
 169          
 170          /* кийж╪Л╡Б╟Ф ╬ьуС╟╢╪Э */
 171          void key_pad_scan_release()
 172          {
 173   1        uint8_t row = 255, column = 255; //пп╨есКап╨её╛255йгд╛хож╣ё╛нчп╖ж╣
 174   1        
 175   1        /* ╡ывВIO©з */
 176   1        P3 = 0x0F; // P30 - P33╬ЫйДЁЖ╦ъ╣Гф╫ё╛P34 - P37╬ЫйДЁЖ╣м╣Гф╫ё╛й╣╪йиоP36╨мP37йг╡╩сц╧э╣дё╛ж╩йгп╢фПю╢╥╫╠Ц
 177   1        P4 = 0x00; // P4йДЁЖ╣м╣Гф╫ё╛й╣╪йиож╩пХр╙P42╨мP44йДЁЖ╣м╣Гф╫╪╢©и
C51 COMPILER V9.60.0.0   KEY                                                               03/20/2023 10:31:11 PAGE 4   

 178   1        
 179   1        if (~P3 & 0x0F) //хГ╧Шсп╟╢╪Э╟╢обё╩уБюО©ирт╥╜рКн╙P3х║╥╢╨Сфа╠н╣Т╦ъкдн╩ё╛сп╟╢╪Э╟╢обтРуБ╦Ж╫А╧Ш╬м╡╩н╙аЦё╛╨мг╟ц
             -Ф╤юа╒╟╢╪Эр╩жб╣д
 180   1        {
 181   2          /* ппеп╤о */
 182   2          if (!P30) //╣з1пп
 183   2            row = 0;
 184   2          else if (!P31) //╣з2пп
 185   2            row = 1;
 186   2          else if (!P32) //╣з3пп
 187   2            row = 2;
 188   2          else if (!P33) //╣з4пп
 189   2            row = 3;
 190   2          
 191   2          /* ╡ывВIO©з */
 192   2          P3 = 0xF0; // P30 - P33╬ЫйДЁЖ╣м╣Гф╫ё╛P34 - P37╬ЫйДЁЖ╦ъ╣Гф╫ё╛й╣╪йиоP36╨мP37йг╡╩сц╧э╣дё╛ж╩йгп╢фПю╢╥╫╠Ц
 193   2          P4 = 0xFF; // P4йДЁЖ╦ъ╣Гф╫ё╛й╣╪йиож╩пХр╙P42╨мP44йДЁЖ╦ъ╣Гф╫╪╢©и
 194   2        
 195   2          /* апеп╤о */
 196   2          if (!P34) //╣з1ап
 197   2            column = 0;
 198   2          else if (!P35) //╣з2ап
 199   2            column = 1;
 200   2          else if (!P42) //╣з3ап
 201   2            column = 2;
 202   2          else if (!P44) //╣з4ап
 203   2            column = 3;
 204   2          
 205   2          /* ╪Эж╣еп╤о */
 206   2          if (row != 255 && column != 255) //хГ╧Ш╟╢╪Эспп╖
 207   2          {
 208   3            key_value = key_pad_value_all[row][column];
 209   3          }
 210   2          
 211   2          /* ╟╢╪Э╪фй╠ */
 212   2          if (key_state < 250)
 213   2            key_state++;
 214   2        }
 215   1        else
 216   1        {
 217   2          /* ╨мц╩╢Ькийж╪Л╡Б╣д╟Ф╠╬ж╩спобцФ╣дгЬ╠П */
 218   2          if (key_value && (key_state <= 250)) //хГ╧Ш╟╢╪Э╦уки©╙
 219   2          {
 220   3            if (key_state < 100) //хТ╟╢об╣╫кийжй╠╪Дц╩спЁ╛╧Щ1цК
 221   3              key_state = 255;
 222   3            else if (key_state < 200) //хТ╟╢об╣╫кийжй╠╪ДЁ╛╧Щ1цК╤Ьц╩Ё╛╧Щ2цК
 223   3              key_state = 254;
 224   3            else //хТ╟╢об╣╫кийжй╠╪ДЁ╛╧Щ2цК
 225   3              key_state = 253;
 226   3          }
 227   2          else //╟╢╪ЭмЙх╚ки©╙
 228   2          {
 229   3            key_value = 0;
 230   3            key_state = 0;
 231   3          }
 232   2        }
 233   1      }
 234          
 235          /* ╢╝©зЁЕм╩╪У╟К╪Р╣╔╟Ф ╬ьуС╟╢╪Э */
 236          void key_pad_half_scan_simple()
 237          {
 238   1        uint8_t row = 255, column = 255; //пп╨есКап╨её╛255йгд╛хож╣ё╛нчп╖ж╣
C51 COMPILER V9.60.0.0   KEY                                                               03/20/2023 10:31:11 PAGE 5   

 239   1        
 240   1        /* ╡ывВIO©з */
 241   1        P3 &= ~0x30; P4 &= ~0x14; // P34 P35 P42 P44йДЁЖ╣м╣Гф╫
 242   1        P3 |= 0x0C;               // P32╨мP33йДЁЖ╦ъ╣Гф╫
 243   1      
 244   1        if (~P3 & 0x0C) //хГ╧Шсп╟╢╪Э╟╢об
 245   1        {
 246   2          /* ппеп╤о */
 247   2          if (!P32) //╣з1пп
 248   2            row = 0;
 249   2          else if (!P33) //╣з2пп
 250   2            row = 1;
 251   2          
 252   2          /* ╡ывВIO©з */
 253   2          P3 |= 0x30; P4 |= 0x14; // P34 P35 P42 P44йДЁЖ╦ъ╣Гф╫
 254   2          P3 &= ~0x0C;            // P32╨мP33йДЁЖ╣м╣Гф╫
 255   2          
 256   2          /* апеп╤о */
 257   2          if (!P34) //╣з1ап
 258   2            column = 0;
 259   2          else if (!P35) //╣з2ап
 260   2            column = 1;
 261   2          else if (!P42) //╣з3ап
 262   2            column = 2;
 263   2          else if (!P44) //╣з4ап
 264   2            column = 3;
 265   2          
 266   2          /* ╪Эж╣еп╤о */
 267   2          if (row != 255 && column != 255) //хГ╧Ш╟╢╪Эспп╖
 268   2          {
 269   3            key_value = key_pad_value_half[row][column];
 270   3          }
 271   2          
 272   2          /* ╟╢╪Э╪фй╠ */
 273   2          if (key_state < 250)
 274   2            key_state++;
 275   2        }
 276   1        else
 277   1        {
 278   2          key_value = 0;
 279   2          key_state = 0;
 280   2        }
 281   1      }
 282          
 283          /* ╢╝©зхЩнЕк╚к╚ЁЕм╩╡пх╠╪Р╣╔╟Ф ╬ьуС╟╢╪Э */
 284          void key_pad_remain_scan_simple()
 285          {
 286   1        uint8_t row = 255, column = 255; //пп╨есКап╨её╛255йгд╛хож╣ё╛нчп╖ж╣
 287   1        
 288   1        /* ╡ывВIO©з */
 289   1        P3 &= ~0x20; P4 &= ~0x14; // P35 P42 P44йДЁЖ╣м╣Гф╫
 290   1        P3 |= 0x0C;               // P32╨мP33йДЁЖ╦ъ╣Гф╫
 291   1      
 292   1        if (~P3 & 0x0C) //хГ╧Шсп╟╢╪Э╟╢об
 293   1        {
 294   2          /* ппеп╤о */
 295   2          if (!P32) //╣з1пп
 296   2            row = 0;
 297   2          else if (!P33) //╣з2пп
 298   2            row = 1;
 299   2          
 300   2          /* ╡ывВIO©з */
C51 COMPILER V9.60.0.0   KEY                                                               03/20/2023 10:31:11 PAGE 6   

 301   2          P3 |= 0x20; P4 |= 0x14; // P35 P42 P44йДЁЖ╦ъ╣Гф╫
 302   2          P3 &= ~0x0C;            // P32╨мP33йДЁЖ╣м╣Гф╫
 303   2          
 304   2          /* апеп╤о */
 305   2          if (!P35) //╣з1ап
 306   2            column = 0;
 307   2          else if (!P42) //╣з2ап
 308   2            column = 1;
 309   2          else if (!P44) //╣з3ап
 310   2            column = 2;
 311   2          
 312   2          /* ╪Эж╣еп╤о */
 313   2          if (row != 255 && column != 255) //хГ╧Ш╟╢╪Эспп╖
 314   2          {
 315   3            key_value = key_pad_value_remain[row][column];
 316   3          }
 317   2          
 318   2          /* ╟╢╪Э╪фй╠ */
 319   2          if (key_state < 250)
 320   2            key_state++;
 321   2        }
 322   1        else
 323   1        {
 324   2          key_value = 0;
 325   2          key_state = 0;
 326   2        }
 327   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    723    ----
   CONSTANT SIZE    =     30    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
