C51 COMPILER V9.60.0.0   KEY                                                               03/29/2023 19:47:31 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\others) DEBUG OBJECTEXTEND PRINT
                    -(.\Listings\key.lst) TABS(2) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "key.h"
   2          
   3          /* ÏÂÃæÁÐ³öµÄËùÓÐ°´¼üº¯Êý
   4             ¾ùÊ¹ÓÃÕâÁ½¸ö±äÁ¿×÷ÎªÊä³ö£¬
   5             Ö÷º¯ÊýÀïÖ»ÐèÒªÅÐ¶ÏÕâÁ½¸ö±äÁ¿£¬
   6             ¼´¿É»ñÈ¡°´¼ü×´Ì¬ÐÅÏ¢ */
   7          uint8_t key_value = 0; //È¡Öµ·¶Î§4 - 19
   8          uint8_t key_state = 0;
   9          /* key_state±íÊ¾°´¼üµ±Ç°×´Ì¬
  10             0£º±íÊ¾Î´°´ÏÂ
  11             1£º°´¼üÕýÔÚÏû¶¶´¦Àí
  12             2 - 250£º±íÊ¾Ïû¶¶ÒÔºó°´ÏÂµÄÊ±¼ä£¬µ¥Î»ÊÇ10ms
  13                      ±¾Ä£°åÖ»¼ÆÊ±µ½2.5Ãë£¬ÐèÒªµÄ¿ÉÒÔÑÓ³¤
  14                      ×¢ÒâÒª¸Ä³Éuint16_tÀàÐÍ
  15             253£ºµ±Ç°°´¼ü´Ó°´ÏÂµ½ËÉ¿ªµÄÊ±¼ä´óÓÚ2Ãë
  16             254£ºµ±Ç°°´¼ü´Ó°´ÏÂµ½ËÉ¿ªµÄÊ±¼äÔÚ1Ãëµ½2ÃëÖ®¼ä
  17             255£ºµ±Ç°°´¼ü´Ó°´ÏÂµ½ËÉ¿ªµÄÊ±¼ä²»µ½1Ãë */
  18          
  19          /* ¼üÖµ²éÑ¯±í */
  20          uint8_t code key_pad_value_all[4][4] = 
  21          { //³£ÓÃÓÚ¾ØÕó°´¼ü
  22            {7, 11, 15, 19, },
  23            {6, 10, 14, 18, },
  24            {5, 9, 13, 17, },
  25            {4, 8, 12, 16, },
  26          };
  27          /* Ò»°ã¶¼ÊÇ10ms×óÓÒµ÷ÓÃÒ»´Î£¬
  28             10msÎªÏû¶¶Ê±¼ä£¬¿ÉÒÔ¸ù¾ÝÐèÒª¸ü¸Ä */
  29          /* ¾ØÕó°´¼ü */
  30          void key_pad_scan()
  31          {
  32   1        uint8_t row = 255, column = 255; //ÐÐºÅÓëÁÐºÅ£¬255ÊÇÄ¬ÈÏÖµ£¬¼´ÎÞÐ§Öµ
  33   1        
  34   1        /* ²Ù×÷IO¿Ú£¬ÕâÀï°´Ã¿¸öÎ»À´²Ù×÷µÄ£¬Êµ¼ÊÉÏ¿ÉÒÔÍ³Ò»¸³Öµ */
  35   1      #ifndef USE_UART
                P30 = 1; //µÚ1ÐÐ
                P31 = 1; //µÚ2ÐÐ
              #endif //USE_UART
  39   1        P32 = 1; //µÚ3ÐÐ
  40   1        P33 = 1; //µÚ4ÐÐ
  41   1        
  42   1        P44 = 0; //µÚ1ÁÐ
  43   1        P42 = 0; //µÚ2ÁÐ
  44   1        P35 = 0; //µÚ3ÁÐ
  45   1      #ifndef USE_NE555
  46   1        P34 = 0; //µÚ4ÁÐ
  47   1      #endif //USE_NE555
  48   1        
  49   1        if (~P3 & 0x0F) //Èç¹ûÓÐ°´¼ü°´ÏÂ£»ÕâÀï¿ÉÒÔ·­ÒëÎªP3È¡·´ºóÆÁ±Îµô¸ßËÄÎ»£¬ÓÐ°´¼ü°´ÏÂÔòÕâ¸ö½á¹û¾Í²»ÎªÁã£¬ºÍÇ°Ã
             -æ¶ÀÁ¢°´¼üÒ»ÖÂµÄ
  50   1        {
  51   2          /* ÐÐÅÐ¶Ï */
  52   2          if (!P33) //µÚ4ÐÐ
  53   2            row = 3;
C51 COMPILER V9.60.0.0   KEY                                                               03/29/2023 19:47:31 PAGE 2   

  54   2          else if (!P32) //µÚ3ÐÐ
  55   2            row = 2;
  56   2      #ifndef USE_UART
                  else if (!P31) //µÚ2ÐÐ
                    row = 1;
                  else if (!P30) //µÚ1ÐÐ
                    row = 0;
              #endif //USE_UART
  62   2          else //Èç¹ûÊ¹Îó¶ÁÔòÍË³öº¯Êý
  63   2            return ;
  64   2          
  65   2          /* ²Ù×÷IO¿Ú */
  66   2      #ifndef USE_UART
                  P30 = 0; //µÚ1ÐÐ
                  P31 = 0; //µÚ2ÐÐ
              #endif //USE_UART
  70   2          P32 = 0; //µÚ3ÐÐ
  71   2          P33 = 0; //µÚ4ÐÐ
  72   2          
  73   2          P44 = 1; //µÚ1ÁÐ
  74   2          P42 = 1; //µÚ2ÁÐ
  75   2          P35 = 1; //µÚ3ÁÐ
  76   2          P34 = 1; //µÚ4ÁÐ
  77   2          
  78   2          /* ÁÐÅÐ¶Ï */
  79   2          if (!P44) //µÚ1ÁÐ
  80   2            column = 0;
  81   2          else if (!P42) //µÚ2ÁÐ
  82   2            column = 1;
  83   2          else if (!P35) //µÚ3ÁÐ
  84   2            column = 2;
  85   2      #ifndef USE_NE555
  86   2          else if (!P34) //µÚ4ÁÐ
  87   2            column = 3;
  88   2      #endif //USE_NE555
  89   2          else //Èç¹ûÊ¹Îó¶ÁÔòÍË³öº¯Êý
  90   2            return ;
  91   2          
  92   2          /* ¼üÖµÅÐ¶Ï */
  93   2          if (row != 255 && column != 255) //Èç¹û°´¼üÓÐÐ§
  94   2          {
  95   3            key_value = key_pad_value_all[row][column];
  96   3          }
  97   2          
  98   2          /* °´¼ü¼ÆÊ± */
  99   2          if (key_state < 250)
 100   2            key_state++;
 101   2        }
 102   1        else
 103   1        {
 104   2      #ifdef KEY_RELEASE
 105   2          if (key_value && (key_state <= 250)) //Èç¹û°´¼ü¸ÕËÉ¿ª
 106   2          {
 107   3            if (key_state < 100) //Èô°´ÏÂµ½ËÉÊÖÊ±¼äÃ»ÓÐ³¬¹ý1Ãë
 108   3              key_state = 255;
 109   3            else if (key_state < 200) //Èô°´ÏÂµ½ËÉÊÖÊ±¼ä³¬¹ý1Ãë¶øÃ»³¬¹ý2Ãë
 110   3              key_state = 254;
 111   3            else //Èô°´ÏÂµ½ËÉÊÖÊ±¼ä³¬¹ý2Ãë
 112   3              key_state = 253;
 113   3          }
 114   2          else //°´¼üÍêÈ«ËÉ¿ª
 115   2      #endif //KEY_RELEASE
C51 COMPILER V9.60.0.0   KEY                                                               03/29/2023 19:47:31 PAGE 3   

 116   2          {
 117   3            key_value = 0;
 118   3            key_state = 0;
 119   3          }
 120   2        }
 121   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    179    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
